From b842567969373c4c3112a500f1390f47a91a0e38 Mon Sep 17 00:00:00 2001
From: metacritical <pankajdoharey@gmail.com>
Date: Tue, 23 Dec 2025 19:49:48 +0530
Subject: [PATCH] fix(tml): Override dynamic prompt/header after TML parsing

Variables like current_page, menu_header must be evaluated in bash context.
Added inline --prompt and --header to FZF_DEFAULT_OPTS after tml_fzf_args.
---
 bin/.DS_Store                     | Bin 6148 -> 0 bytes
 modules/ui/catalog/fzf_catalog.sh |   7 ++++++-
 2 files changed, 6 insertions(+), 1 deletion(-)
 delete mode 100644 bin/.DS_Store

diff --git a/bin/.DS_Store b/bin/.DS_Store
deleted file mode 100644
index d241ae724bc00c038759a6ba8efbb2c228399800..0000000000000000000000000000000000000000
GIT binary patch
literal 0
HcmV?d00001

literal 6148
zcmeHKPfrs;6n|4Hv>>vSf+&$RX<|HJsMv$VgSB7`YEnWg77@#CJ1rZwJI(I41(Bp@
zJ^BIs0Ny+pj~+dF)02sJ55^B*qHq4JQ2tznn0?92@9mrS-pu@VXJ!WgNVZwI2A}~z
z1PjM-KUPNwZ|CKZgp{Qhk%$}?P;eJ4RyM3d-hm-tAYkCMF~HYuAJl<C1)8vL{W1ev
z__pvC7x$0fLd4)B;NdEFFs6$BCTz*|?)!%vfY7IX{=MkGff4n+y}|c|Ebcm!$N3s<
zw_#Yq_r1}uOxH`LzK~E)_)Kpf%0S;*euK61p6)f>tnRGxrvhV^;p@7wY|?f~i_bCJ
z(@mQ?BEYOrbb0c~v@5KgWlg){irBnth@zCV@tvJ?Dm|4*r?2l$C3a?KQmD_)?CwS*
zqsi%;OQlV#ZnGDH5g@qx2^m!A!%I}U=5Ll;YEI;<Kc{cnu$omQ+COl1@Z69#92<$p
zMq^`R@v-yc7cNdrTq<cJhF;#RIeffx%wkT~YSPu3V^;DFy=>aGqDQy9y!nilwAcaH
zC0cp9XDVzr&?mlU5b5qZl-eR+u3B}eSKOzsJl3}gf3pv{WrtbTB6Cg8WcJDv7l~i+
zXnn!1GVHvCq~{vE$z7(7i&)YQ#1vO_$I<N?&2Fz*x<Rd+on@ZK>fDoOD>Hl1p*&O3
zM4eA7dF!X7HJQ2ZD_5kVK~gGsP{n;sAxVCq>q0Ns%%;(3GP9_fB5)PvAO}VKHlM>Q
zcnxph9ejk(@Ev}UUJ@sl$uzk^Zj*cD0eMK4NsTl}le9=%W(fK3eNtsqKsu;&z4un$
zu`OoT(C)`5-xCBilE}abjv?qeU?5=NbTYvAhXfXm8HF8*V(Y+4TmcZnXcmGx|7qYc
z356Mj9f{b2LS!hS3?=G{L1Z}E6Ur~6up?210}(xA9@R5ZHxwdzM|(oJ1Ib7X>VScO
zfo=wR<fF#V|2xOu|GR^Nr+|Tgf&YpD5}wb`<5e6F-J^w{wFxZiSh#S%jzkfHl{$`v
h!jIx{EJCm?!4<@e!j43=paeexf`*_982G0Q`~lx{_&)#u

diff --git a/modules/ui/catalog/fzf_catalog.sh b/modules/ui/catalog/fzf_catalog.sh
index 535d259..cf32ada 100644
--- a/modules/ui/catalog/fzf_catalog.sh
+++ b/modules/ui/catalog/fzf_catalog.sh
@@ -221,7 +221,12 @@ show_fzf_catalog() {
     source "${UI_DIR}/tml/parser/tml_parser.sh"
     tml_parse "${UI_DIR}/layouts/main-catalog.xml"
     local tml_fzf_args=$(tml_get_fzf_args)
-    export FZF_DEFAULT_OPTS="--ansi --color=${fzf_colors} ${tml_fzf_args}"
+
+    # Override dynamic values that need bash evaluation (prompt/header)
+    local dynamic_prompt="< Page ${current_page}/${total_pages}${page_suffix} > "
+    local dynamic_header="$menu_header"
+
+    export FZF_DEFAULT_OPTS="--ansi --color=${fzf_colors} ${tml_fzf_args} --prompt=\"${dynamic_prompt}\" --header=\"${dynamic_header}\""
     # OLD: export FZF_DEFAULT_OPTS="--ansi --color=... --layout=reverse ..."


--
2.50.1 (Apple Git-155)

