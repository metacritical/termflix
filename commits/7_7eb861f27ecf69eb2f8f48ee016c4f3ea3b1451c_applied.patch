From 7eb861f27ecf69eb2f8f48ee016c4f3ea3b1451c Mon Sep 17 00:00:00 2001
From: metacritical <pankajdoharey@gmail.com>
Date: Tue, 23 Dec 2025 20:05:07 +0530
Subject: [PATCH] fix(preview): Move OMDB fetch before Sources line for movie
 IMDB rating

The OMDB rating fetch was happening AFTER the Sources/IMDB line was printed.
Moved fetch block before the echo statement so movie_rating is set correctly.
Now both movies and shows will display IMDB ratings.
---
 modules/ui/catalog/preview_fzf.sh | 16 ++++++++--------
 1 file changed, 8 insertions(+), 8 deletions(-)

diff --git a/modules/ui/catalog/preview_fzf.sh b/modules/ui/catalog/preview_fzf.sh
index 759ec46..a1b6e9e 100755
--- a/modules/ui/catalog/preview_fzf.sh
+++ b/modules/ui/catalog/preview_fzf.sh
@@ -239,14 +239,7 @@ if [[ "$source" == "COMBINED" ]]; then
         source_badges+="[${src}]"
     done

-    # Show Sources and IMDB rating on same line
-    imdb_display=""
-    if [[ -n "$movie_rating" ]] && [[ "$movie_rating" != "N/A" ]]; then
-        imdb_display="    ${BOLD}IMDB:${RESET} ${YELLOW}⭐ ${movie_rating}${RESET}"
-    fi
-    echo -e "${BOLD}Sources:${RESET} ${GREEN}${source_badges}${RESET}${imdb_display}"
-
-    # Fetch OMDB metadata for Runtime and Rating
+    # Fetch OMDB metadata for Runtime and Rating (BEFORE printing so movie_rating is set)
     movie_runtime=""
     if [[ -f "$OMDB_MODULE" && "$is_series" == "false" ]]; then
         source "$OMDB_MODULE" 2>/dev/null
@@ -262,6 +255,13 @@ if [[ "$source" == "COMBINED" ]]; then
         fi
     fi

+    # Show Sources and IMDB rating on same line (now movie_rating is set for movies)
+    imdb_display=""
+    if [[ -n "$movie_rating" ]] && [[ "$movie_rating" != "N/A" ]]; then
+        imdb_display="    ${BOLD}IMDB:${RESET} ${YELLOW}⭐ ${movie_rating}${RESET}"
+    fi
+    echo -e "${BOLD}Sources:${RESET} ${GREEN}${source_badges}${RESET}${imdb_display}"
+
     # Deduplicate and format qualities
     seen_quals=()
     quals_display=""
--
2.50.1 (Apple Git-155)
