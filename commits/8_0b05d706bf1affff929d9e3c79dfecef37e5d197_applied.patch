From 0b05d706bf1affff929d9e3c79dfecef37e5d197 Mon Sep 17 00:00:00 2001
From: metacritical <pankajdoharey@gmail.com>
Date: Tue, 23 Dec 2025 20:17:25 +0530
Subject: [PATCH] feat(tml): Unified popup selector styling for Type/Sort/Genre

Created centered popup layouts matching season-picker style:
- type-selector.xml: 50% height, 20%/25% margin
- sort-selector.xml: 40% height, 25%/28% margin
- genre-selector.xml: 60% height, 15%/25% margin

All use rounded borders, glow colors, and consistent prompt styling.
Updated bin/termflix to use TML parser for all 3 selectors.
---
 bin/termflix                          | 18 +++++++++++++++---
 modules/ui/layouts/genre-selector.xml | 26 ++++++++++++++++++++++++++
 modules/ui/layouts/sort-selector.xml  | 26 ++++++++++++++++++++++++++
 modules/ui/layouts/type-selector.xml  | 26 ++++++++++++++++++++++++++
 4 files changed, 93 insertions(+), 3 deletions(-)
 create mode 100644 modules/ui/layouts/genre-selector.xml
 create mode 100644 modules/ui/layouts/sort-selector.xml
 create mode 100644 modules/ui/layouts/type-selector.xml

diff --git a/bin/termflix b/bin/termflix
index 74a2a37..c7c1f7c 100755
--- a/bin/termflix
+++ b/bin/termflix
@@ -494,7 +494,11 @@ main() {
                     menu_items+="${ind_ctx_title} ðŸ”¤ By Title (Mode)...\n"

                     local selected_action
-                    selected_action=$(echo -e "$menu_items" | fzf --height=16 --layout=reverse --border --prompt="Type > " --header="Select Content Mode (Current marks: â—)" 2>/dev/null)
+                    # Use TML layout for centered popup style
+                    source "$SCRIPT_DIR/../modules/ui/tml/parser/tml_parser.sh"
+                    tml_parse "$SCRIPT_DIR/../modules/ui/layouts/type-selector.xml"
+                    local type_fzf_args=$(tml_get_fzf_args)
+                    selected_action=$(echo -e "$menu_items" | eval "fzf $type_fzf_args" 2>/dev/null)

                     # Handle Esc/Cancel (Empty selection) - Just continue to re-render without changing state
                     [[ -z "$selected_action" ]] && continue
@@ -554,7 +558,11 @@ main() {
                     esac

                     local sel_sort
-                    sel_sort=$(echo -e "$sort_menu" | fzf --height=12 --layout=reverse --border --prompt="Sort: " --header="Sort & Tweak ($current_context)" 2>/dev/null)
+                    # Use TML layout for centered popup style
+                    source "$SCRIPT_DIR/../modules/ui/tml/parser/tml_parser.sh"
+                    tml_parse "$SCRIPT_DIR/../modules/ui/layouts/sort-selector.xml"
+                    local sort_fzf_args=$(tml_get_fzf_args)
+                    sel_sort=$(echo -e "$sort_menu" | eval "fzf $sort_fzf_args" 2>/dev/null)

                     if [[ -n "$sel_sort" ]]; then
                         case "$sel_sort" in
@@ -600,7 +608,11 @@ main() {
                     # Genre dropdown: show FZF popup with genre list
                     local genre_list="All Genres\nAction\nAdventure\nAnimation\nComedy\nCrime\nDocumentary\nDrama\nFamily\nFantasy\nHorror\nMusic\nMystery\nRomance\nSci-Fi\nThriller\nWar\nWestern"
                     local selected_genre
-                    selected_genre=$(echo -e "$genre_list" | fzf --height=15 --layout=reverse --border --prompt="Genre: " --header="Filter by genre" 2>/dev/null)
+                    # Use TML layout for centered popup style
+                    source "$SCRIPT_DIR/../modules/ui/tml/parser/tml_parser.sh"
+                    tml_parse "$SCRIPT_DIR/../modules/ui/layouts/genre-selector.xml"
+                    local genre_fzf_args=$(tml_get_fzf_args)
+                    selected_genre=$(echo -e "$genre_list" | eval "fzf $genre_fzf_args" 2>/dev/null)

                     if [[ -n "$selected_genre" && "$selected_genre" != "All Genres" ]]; then
                         export CURRENT_GENRE="$selected_genre" # Use export for CURRENT_GENRE
diff --git a/modules/ui/layouts/genre-selector.xml b/modules/ui/layouts/genre-selector.xml
new file mode 100644
index 0000000..e8f548e
--- /dev/null
+++ b/modules/ui/layouts/genre-selector.xml
@@ -0,0 +1,26 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+  Genre Selector Layout
+  Centered popup modal for genre filtering
+  Matches season-picker styling with glow colors
+-->
+<fzf-layout id="genre-selector" name="Genre Selector">
+  <layout direction="reverse" height="60%" margin="15%,25%" padding="1" info="inline"/>
+  <border style="rounded" label=" [ Enter:Select | Esc:Back ] " label-pos="bottom"/>
+  <prompt pointer="âžœ">Genre âžœ </prompt>
+  <header first="true">ðŸŽ­ Filter by Genre</header>
+  <colors theme="dynamic">
+    <color name="fg" value="#ffffff"/>
+    <color name="fg+" value="#ffffff"/>
+    <color name="hl" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="hl+" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="pointer" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="border" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="prompt" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="info" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="bg+" value="${THEME_HEX_BG_SELECTION:-#374151}"/>
+  </colors>
+  <bindings>
+    <bind key="esc" action="abort"/>
+  </bindings>
+</fzf-layout>
diff --git a/modules/ui/layouts/sort-selector.xml b/modules/ui/layouts/sort-selector.xml
new file mode 100644
index 0000000..081e8d0
--- /dev/null
+++ b/modules/ui/layouts/sort-selector.xml
@@ -0,0 +1,26 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+  Sort Selector Layout
+  Centered popup modal for sort/tweak selection
+  Matches season-picker styling with glow colors
+-->
+<fzf-layout id="sort-selector" name="Sort Selector">
+  <layout direction="reverse" height="40%" margin="25%,28%" padding="1" info="inline"/>
+  <border style="rounded" label=" [ Enter:Select | Esc:Back ] " label-pos="bottom"/>
+  <prompt pointer="âžœ">Sort âžœ </prompt>
+  <header first="true">ðŸ“Š Sort &amp; Tweak Options</header>
+  <colors theme="dynamic">
+    <color name="fg" value="#ffffff"/>
+    <color name="fg+" value="#ffffff"/>
+    <color name="hl" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="hl+" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="pointer" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="border" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="prompt" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="info" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="bg+" value="${THEME_HEX_BG_SELECTION:-#374151}"/>
+  </colors>
+  <bindings>
+    <bind key="esc" action="abort"/>
+  </bindings>
+</fzf-layout>
diff --git a/modules/ui/layouts/type-selector.xml b/modules/ui/layouts/type-selector.xml
new file mode 100644
index 0000000..4a5cf27
--- /dev/null
+++ b/modules/ui/layouts/type-selector.xml
@@ -0,0 +1,26 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+  Type Selector Layout
+  Centered popup modal for content mode selection
+  Matches season-picker styling with glow colors
+-->
+<fzf-layout id="type-selector" name="Type Selector">
+  <layout direction="reverse" height="50%" margin="20%,25%" padding="1" info="inline"/>
+  <border style="rounded" label=" [ Enter:Select | Esc:Back ] " label-pos="bottom"/>
+  <prompt pointer="âžœ">Select Mode âžœ </prompt>
+  <header first="true">ðŸŽ¬ Select Content Mode</header>
+  <colors theme="dynamic">
+    <color name="fg" value="#ffffff"/>
+    <color name="fg+" value="#ffffff"/>
+    <color name="hl" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="hl+" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="pointer" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="border" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="prompt" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="info" value="${THEME_HEX_GLOW:-#e879f9}"/>
+    <color name="bg+" value="${THEME_HEX_BG_SELECTION:-#374151}"/>
+  </colors>
+  <bindings>
+    <bind key="esc" action="abort"/>
+  </bindings>
+</fzf-layout>
--
2.50.1 (Apple Git-155)

